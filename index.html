<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#E31937">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <title>Tesla Multi-Stream â€¢ 2026â€“2040</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap');
        body { font-family: 'Inter', system_ui, sans-serif; }
        .title-font { font-family: 'Space Grotesk', sans-serif; }
        .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(20px); }
        .chart-container { position: relative; height: 340px; }
        @media (max-width: 1024px) { .chart-container { height: 280px; } }
        table { min-width: 1850px; }
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(227, 25, 55, 0.3);
            border-color: #E31937;
        }
        .section-card:hover { transform: translateY(-4px); }
        label { font-size: 0.75rem; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen pb-12">
    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-zinc-950/80 backdrop-blur-xl border-b border-zinc-800">
        <div class="max-w-screen-2xl mx-auto px-6 py-5 flex items-center justify-between">
            <div class="flex items-center gap-x-4">
                <div class="w-9 h-9 bg-red-600 rounded-2xl flex items-center justify-center text-white font-black text-2xl leading-none pt-0.5">T</div>
                <div class="title-font text-3xl font-semibold tracking-tighter">TESLA MULTI-STREAM</div>
            </div>
            <div class="flex items-center gap-x-3">
                <button onclick="fetchTslaPrice()" class="px-5 py-2.5 text-xs font-semibold bg-zinc-900 hover:bg-zinc-800 border border-zinc-700 rounded-2xl transition-all">LIVE TSLA</button>
                <button onclick="fetchExchangeRate()" class="px-5 py-2.5 text-xs font-semibold bg-zinc-900 hover:bg-zinc-800 border border-zinc-700 rounded-2xl transition-all">EUR RATE</button>
            </div>
        </div>
    </header>

    <div class="max-w-screen-2xl mx-auto px-6 pt-10">
        <!-- QUICK TARGETS -->
        <div class="glass border border-zinc-700 rounded-3xl p-10 mb-12">
            <div class="text-center mb-10">
                <div class="inline-flex items-center gap-x-2 bg-zinc-900 border border-red-900/50 text-red-400 text-xs font-medium px-6 py-2 rounded-3xl">
                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                    2026 â€” 2040 VALUATION ENGINE
                </div>
                <h1 class="title-font text-6xl md:text-7xl font-bold tracking-tighter mt-4 bg-gradient-to-r from-white via-zinc-200 to-red-300 bg-clip-text text-transparent">
                    TESLA MULTI-STREAM
                </h1>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">OPTIMUS (millions)</label>
                    <input id="target_opt_fleet" value="10" type="number" step="1" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">Ramp by year</label>
                    <input id="opt_ramp_year" value="2033" type="number" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">ROBOTAXI (millions)</label>
                    <input id="target_rt_fleet" value="3" type="number" step="1" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">Ramp by year</label>
                    <input id="rt_ramp_year" value="2032" type="number" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">ROBOTRUCK (thousands)</label>
                    <input id="target_rtr_fleet" value="50" type="number" step="5" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">Ramp by year</label>
                    <input id="rtr_ramp_year" value="2035" type="number" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5 font-medium">ENERGY (GWh/yr)</label>
                    <input id="target_energy_gwh" value="600" type="number" step="50" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-4xl font-semibold text-center">
                </div>
                <div class="flex items-end">
                    <button id="applyTargetsBtn"
                            class="w-full h-[72px] bg-red-600 hover:bg-red-500 active:bg-red-700 transition-all font-semibold text-xl rounded-3xl shadow-2xl shadow-red-900/50">
                        APPLY TARGETS â†’ AUTO RAMP
                    </button>
                </div>
            </div>
            <p class="text-center text-zinc-500 text-xs mt-6">Ramp completes by chosen year â€¢ then grows at default rate â€¢ Set target=0 to disable</p>
        </div>

        <!-- ASSUMPTIONS -->
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8 mb-16">
            <!-- Core -->
            <div class="xl:col-span-5 glass border border-zinc-700 rounded-3xl p-8 section-card">
                <h2 class="text-red-400 text-sm font-semibold tracking-widest mb-6">CORE ASSUMPTIONS</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-2">DILUTED SHARES (B)</label>
                        <input id="shares_out" value="3.52" step="0.01" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-2xl font-semibold">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-2">GROWTH PE</label>
                        <input id="multiple_growth" value="40" step="5" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-2xl font-semibold">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-2">MATURE PE</label>
                        <input id="multiple_mature" value="25" step="5" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-2xl font-semibold">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-2">YOUR SHARES</label>
                        <input id="your_shares" value="380" step="1" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5 text-2xl font-semibold">
                    </div>
                </div>
            </div>

            <!-- Optimus -->
            <div class="glass border border-zinc-700 rounded-3xl p-8 section-card">
                <div class="flex justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <span class="text-5xl">ðŸ¤–</span>
                        <div><h3 class="text-2xl font-semibold">OPTIMUS</h3><p class="text-emerald-400 text-sm">Humanoid robot</p></div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="opt_enable" checked class="sr-only peer">
                        <div class="w-14 h-7 bg-zinc-700 peer-focus:ring-4 peer-focus:ring-red-500 rounded-full peer peer-checked:bg-red-600 after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Effective $/hr</label>
                        <input id="opt_hourly" value="2" step="0.1" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Hours/Day</label>
                        <input id="opt_hours_day" value="21" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Sales Price ($)</label>
                        <input id="opt_sales_price" value="20000" step="1000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Gross Margin %</label>
                        <input id="opt_sales_margin" value="7" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                </div>
            </div>

            <!-- Robotaxi -->
            <div class="glass border border-zinc-700 rounded-3xl p-8 section-card">
                <div class="flex justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <span class="text-5xl">ðŸš•</span>
                        <div><h3 class="text-2xl font-semibold">ROBOTAXI</h3><p class="text-amber-400 text-sm">Autonomous ride-hail</p></div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="rt_enable" checked class="sr-only peer">
                        <div class="w-14 h-7 bg-zinc-700 peer-focus:ring-4 peer-focus:ring-red-500 rounded-full peer peer-checked:bg-red-600 after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Avg km/day</label>
                        <input id="rt_mileage_km" value="350" step="10" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Net $/mile</label>
                        <input id="rt_earnings_mile" value="0.2" step="0.01" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Sales Price ($)</label>
                        <input id="rt_sales_price" value="25000" step="1000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Gross Margin %</label>
                        <input id="rt_sales_margin" value="7" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                </div>
            </div>

            <!-- Robotruck -->
            <div class="glass border border-zinc-700 rounded-3xl p-8 section-card">
                <div class="flex justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <span class="text-4xl">ðŸš›</span>
                        <div><h3 class="text-xl font-semibold">ROBOTRUCK</h3></div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="rtr_enable" checked class="sr-only peer">
                        <div class="w-11 h-6 bg-zinc-700 peer-focus:ring-4 peer-focus:ring-red-500 rounded-full peer peer-checked:bg-red-600"></div>
                    </label>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Avg km/day</label>
                        <input id="rtr_mileage_km" value="500" step="50" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Net $/mile</label>
                        <input id="rtr_earnings_mile" value="2" step="0.1" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Sales Price ($)</label>
                        <input id="rtr_sales_price" value="250000" step="10000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Gross Margin %</label>
                        <input id="rtr_sales_margin" value="7" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                </div>
            </div>

            <!-- Energy -->
            <div class="glass border border-zinc-700 rounded-3xl p-8 section-card">
                <div class="flex justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <span class="text-4xl">âš¡</span>
                        <div><h3 class="text-xl font-semibold">ENERGY STORAGE</h3></div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="energy_enable" checked class="sr-only peer">
                        <div class="w-11 h-6 bg-zinc-700 peer-focus:ring-4 peer-focus:ring-red-500 rounded-full peer peer-checked:bg-red-600"></div>
                    </label>
                </div>
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Hardware Revenue $/GWh</label>
                        <input id="energy_hw_rev_per_gwh" value="280000000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1.5">Recurring $/GWh installed/yr</label>
                        <input id="energy_recurring_per_gwh_yr" value="3500000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-5 py-4">
                    </div>
                </div>
            </div>
        </div>

        <!-- BELGIUM TAX -->
        <div class="glass border border-zinc-700 rounded-3xl p-8 mb-16 max-w-2xl mx-auto">
            <h2 class="text-red-400 text-sm font-semibold tracking-widest mb-6 text-center">ðŸ‡§ðŸ‡ª BELGIUM TAX &amp; CURRENCY</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">Current TSLA Price ($)</label>
                    <input id="current_tsla_price" value="439" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">USD to EUR Rate</label>
                    <input id="usd_eur_rate" value="0.86" step="0.0001" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">Average Buy Price (â‚¬/share)</label>
                    <input id="avg_buy_price" value="280" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">Capital Gains Tax %</label>
                    <input id="cgt_rate" value="10" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">CGT Exemption (â‚¬)</label>
                    <input id="cgt_exemption" value="10000" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1.5">Annual Wealth Tax %</label>
                    <input id="annual_tax_rate" value="0.30" step="0.01" class="input-focus w-full bg-zinc-900 border border-zinc-700 rounded-3xl px-6 py-5">
                </div>
            </div>
        </div>

        <!-- TABLE -->
        <div id="table-section" class="mb-20">
            <div class="flex justify-between items-center mb-8">
                <h2 class="title-font text-5xl font-bold tracking-tighter">Production &amp; Valuation Table</h2>
                <button id="exportCsvBtn" class="flex items-center gap-3 bg-zinc-900 hover:bg-zinc-800 border border-zinc-700 px-8 py-4 rounded-3xl font-medium transition-all">EXPORT FULL CSV <span class="text-red-400">â†“</span></button>
            </div>
            <div class="overflow-x-auto rounded-3xl border border-zinc-800 shadow-2xl">
                <table class="w-full text-sm">
                    <thead class="bg-zinc-900 sticky top-0 z-10">
                        <tr class="border-b border-zinc-700">
                            <th class="px-6 py-6 text-left">YEAR</th>
                            <th class="px-6 py-6 text-center">Optimus Prod</th>
                            <th class="px-6 py-6 text-center font-semibold text-emerald-400">Fleet</th>
                            <th class="px-6 py-6 text-center">Robotaxi Prod</th>
                            <th class="px-6 py-6 text-center font-semibold text-amber-400">Fleet</th>
                            <th class="px-6 py-6 text-center">Robotruck Prod</th>
                            <th class="px-6 py-6 text-center font-semibold text-purple-400">Fleet</th>
                            <th class="px-6 py-6 text-center">Energy GWh</th>
                            <th class="px-6 py-6 text-center font-semibold text-cyan-400">Cum GWh</th>
                            <th class="px-6 py-6 text-center text-emerald-400">Opt $/sh</th>
                            <th class="px-6 py-6 text-center text-amber-400">RT $/sh</th>
                            <th class="px-6 py-6 text-center text-purple-400">RTR $/sh</th>
                            <th class="px-6 py-6 text-center text-cyan-400">Energy $/sh</th>
                            <th class="px-6 py-6 text-center font-bold text-red-400">TOTAL $/sh</th>
                            <th class="px-6 py-6 text-center">MktCap $T</th>
                            <th class="px-6 py-6 text-center text-pink-400">Your $</th>
                            <th class="px-6 py-6 text-center">Your â‚¬</th>
                            <th class="px-6 py-6 text-center text-rose-400">Wealth Tax â‚¬</th>
                        </tr>
                    </thead>
                    <tbody id="yearTable" class="divide-y divide-zinc-800"></tbody>
                </table>
            </div>
        </div>

        <!-- CHARTS -->
        <div class="mb-20">
            <h2 class="title-font text-5xl font-bold tracking-tighter text-center mb-12">Live Visuals</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Cumulative Fleet Growth</h3><div class="chart-container"><canvas id="fleetLineChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Optimus Production</h3><div class="chart-container"><canvas id="optProductionChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Robotaxi Production</h3><div class="chart-container"><canvas id="rtProductionChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Robotruck Production</h3><div class="chart-container"><canvas id="rtrProductionChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Energy Deployment</h3><div class="chart-container"><canvas id="energyProductionChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 class="text-center mb-4 text-zinc-400">Share Price Evolution</h3><div class="chart-container"><canvas id="sharePriceChart"></canvas></div></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 id="optRevTitle" class="text-center mb-4 text-emerald-400">Optimus Revenue ($B)</h3><div class="chart-container"><canvas id="optRevenueChart"></canvas></div></div>
                <div class="glass border border-zinc-700 rounded-3xl p-6"><h3 id="rtRevTitle" class="text-center mb-4 text-amber-400">Robotaxi Revenue ($B)</h3><div class="chart-container"><canvas id="rtRevenueChart"></canvas></div></div>
            </div>
        </div>

        <!-- RESULTS -->
        <div class="glass border border-zinc-700 rounded-3xl p-12">
            <h2 class="title-font text-5xl font-bold text-center mb-12">2040 VALUATION BREAKDOWN</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-zinc-900/70 rounded-3xl p-8 border border-emerald-900/30">
                    <div class="flex items-center gap-4 mb-8"><span class="text-5xl">ðŸ¤–</span><div><p class="uppercase text-xs text-emerald-400">OPTIMUS</p><p id="optPerShare" class="text-4xl font-semibold">$0</p></div></div>
                    <p class="text-xs text-zinc-400">Hardware sales profit per share</p><p id="optSalesPerShare" class="text-2xl font-medium text-emerald-400">$0</p>
                </div>
                <div class="bg-zinc-900/70 rounded-3xl p-8 border border-amber-900/30">
                    <div class="flex items-center gap-4 mb-8"><span class="text-5xl">ðŸš•</span><div><p class="uppercase text-xs text-amber-400">ROBOTAXI</p><p id="rtPerShare" class="text-4xl font-semibold">$0</p></div></div>
                    <p class="text-xs text-zinc-400">Hardware sales profit per share</p><p id="rtSalesPerShare" class="text-2xl font-medium text-amber-400">$0</p>
                </div>
                <div class="bg-zinc-900/70 rounded-3xl p-8 border border-purple-900/30">
                    <div class="flex items-center gap-4 mb-8"><span class="text-5xl">ðŸš›</span><div><p class="uppercase text-xs text-purple-400">ROBOTRUCK</p><p id="rtrPerShare" class="text-4xl font-semibold">$0</p></div></div>
                    <p class="text-xs text-zinc-400">Hardware sales profit per share</p><p id="rtrSalesPerShare" class="text-2xl font-medium text-purple-400">$0</p>
                </div>
                <div class="bg-zinc-900/70 rounded-3xl p-8 border border-cyan-900/30">
                    <div class="flex items-center gap-4 mb-8"><span class="text-5xl">âš¡</span><div><p class="uppercase text-xs text-cyan-400">ENERGY</p><p id="energyPerShare" class="text-4xl font-semibold">$0</p></div></div>
                    <p class="text-xs text-zinc-400">Hardware sales profit per share</p><p id="energySalesPerShare" class="text-2xl font-medium text-cyan-400">$0</p>
                </div>
            </div>
            <div class="mt-16 bg-gradient-to-br from-zinc-900 to-zinc-950 border border-red-500/30 rounded-3xl p-12 text-center">
                <p class="text-red-400 text-sm font-medium tracking-widest mb-3">COMBINED 2040 VALUE</p>
                <p id="combinedPerShare" class="text-7xl font-bold">$0</p>
                <div class="h-px bg-gradient-to-r from-transparent via-red-500/30 to-transparent my-10"></div>
                <div class="flex flex-col md:flex-row justify-center items-center gap-12">
                    <div>
                        <p class="text-zinc-400">YOUR PORTFOLIO <span id="yourSharesDisplay" class="font-semibold text-white">@ 380 shares</span></p>
                        <p id="portfolioValue" class="text-6xl font-bold text-pink-400">$0</p>
                    </div>
                    <div class="text-5xl text-zinc-600">â†’</div>
                    <div>
                        <p class="text-zinc-400">NET AFTER CGT (EUR)</p>
                        <p id="netEur" class="text-6xl font-bold text-emerald-400">â‚¬0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const startYear = 2026;
        const endYear = 2040;
        const years = endYear - startYear + 1;
        const tableBody = document.getElementById('yearTable');

        const yearLabels = Array.from({length: years}, (_, i) => startYear + i);

        let fleetLineChart, optProdChart, rtProdChart, rtrProdChart, energyProdChart, sharePriceChart, optRevChart, rtRevChart;

        const PE_TRANSITION_YEARS = 5;

        function initTailwind() {
            tailwind.config = { content: [], theme: { extend: { colors: { 'tesla-red': '#E31937' } } } };
        }

        function initCharts() {
            fleetLineChart = new Chart(document.getElementById('fleetLineChart'), {
                type: 'line', data: { labels: yearLabels, datasets: [
                    { label: 'Optimus Fleet', data: [], borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.15)', fill: true, tension: 0.2 },
                    { label: 'Robotaxi Fleet', data: [], borderColor: '#fbbf24', backgroundColor: 'rgba(251,191,36,0.15)', fill: true, tension: 0.2 },
                    { label: 'Robotruck Fleet', data: [], borderColor: '#a855f7', backgroundColor: 'rgba(168,85,247,0.15)', fill: true, tension: 0.2 }
                ]}, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } }, plugins: { legend: { labels: { color: '#ddd' } } } }
            });

            optProdChart = new Chart(document.getElementById('optProductionChart'), {
                type: 'bar', data: { labels: yearLabels, datasets: [
                    { label: 'Annual Prod.', data: [], backgroundColor: '#34d399' },
                    { label: 'Cumulative', data: [], type: 'line', borderColor: '#10b981', borderWidth: 3 }
                ]}, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            rtProdChart = new Chart(document.getElementById('rtProductionChart'), {
                type: 'bar', data: { labels: yearLabels, datasets: [
                    { label: 'Annual Prod.', data: [], backgroundColor: '#fcd34d' },
                    { label: 'Cumulative', data: [], type: 'line', borderColor: '#fbbf24', borderWidth: 3 }
                ]}, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            rtrProdChart = new Chart(document.getElementById('rtrProductionChart'), {
                type: 'bar', data: { labels: yearLabels, datasets: [
                    { label: 'Annual Prod.', data: [], backgroundColor: '#c084fc' },
                    { label: 'Cumulative', data: [], type: 'line', borderColor: '#a855f7', borderWidth: 3 }
                ]}, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            energyProdChart = new Chart(document.getElementById('energyProductionChart'), {
                type: 'bar', data: { labels: yearLabels, datasets: [
                    { label: 'Annual GWh', data: [], backgroundColor: '#67e8f9' },
                    { label: 'Cumulative', data: [], type: 'line', borderColor: '#22d3ee', borderWidth: 3 }
                ]}, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            sharePriceChart = new Chart(document.getElementById('sharePriceChart'), {
                type: 'line', data: { labels: yearLabels, datasets: [{ label: 'Share Price $', data: [], borderColor: '#E31937', borderWidth: 4, tension: 0.3 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            optRevChart = new Chart(document.getElementById('optRevenueChart'), {
                type: 'line', data: { labels: yearLabels, datasets: [{ label: 'Revenue $B', data: [], borderColor: '#10b981', fill: true }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });

            rtRevChart = new Chart(document.getElementById('rtRevenueChart'), {
                type: 'line', data: { labels: yearLabels, datasets: [{ label: 'Revenue $B', data: [], borderColor: '#fbbf24', fill: true }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#27272a' } } } }
            });
        }

        function buildTable() {
            tableBody.innerHTML = '';
            for (let i = 0; i < years; i++) {
                const year = startYear + i;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium">${year}</td>
                    <td><input type="number" class="opt_prod w-full text-center bg-transparent" data-year="${year}" value="0" step="100000"></td>
                    <td class="opt_fleet font-semibold text-emerald-400"></td>
                    <td><input type="number" class="rt_prod w-full text-center bg-transparent" data-year="${year}" value="0" step="100000"></td>
                    <td class="rt_fleet font-semibold text-amber-400"></td>
                    <td><input type="number" class="rtr_prod w-full text-center bg-transparent" data-year="${year}" value="0" step="100"></td>
                    <td class="rtr_fleet font-semibold text-purple-400"></td>
                    <td><input type="number" class="energy_gwh w-full text-center bg-transparent" data-year="${year}" value="0" step="10"></td>
                    <td class="energy_cum font-semibold text-cyan-400"></td>
                    <td class="yearly-opt-contrib"></td>
                    <td class="yearly-rt-contrib"></td>
                    <td class="yearly-rtr-contrib"></td>
                    <td class="yearly-energy-contrib"></td>
                    <td class="yearly-price font-bold text-red-400"></td>
                    <td class="yearly-marketcap"></td>
                    <td class="yearly-portfolio"></td>
                    <td class="yearly-portfolio-eur"></td>
                    <td class="yearly-annual-tax"></td>
                `;
                tableBody.appendChild(row);
            }
        }

        document.getElementById('applyTargetsBtn').addEventListener('click', () => {
            const targetOptM   = parseFloat(document.getElementById('target_opt_fleet').value) || 0;
            const optRampYear  = parseInt(document.getElementById('opt_ramp_year').value) || 2040;
            const optGrowthPct = 10;

            const targetRtM    = parseFloat(document.getElementById('target_rt_fleet').value) || 0;
            const rtRampYear   = parseInt(document.getElementById('rt_ramp_year').value) || 2040;
            const rtGrowthPct  = 10;

            const targetRtrK   = parseFloat(document.getElementById('target_rtr_fleet').value) || 0;
            const rtrRampYear  = parseInt(document.getElementById('rtr_ramp_year').value) || 2040;
            const rtrGrowthPct = 6;

            const targetEnergyGWh = parseFloat(document.getElementById('target_energy_gwh').value) || 0;
            const energyRampYear  = parseInt(document.getElementById('rtr_ramp_year').value) || 2040;
            const energyGrowthPct = 15;

            const optInputs    = document.querySelectorAll('.opt_prod');
            const rtInputs     = document.querySelectorAll('.rt_prod');
            const rtrInputs    = document.querySelectorAll('.rtr_prod');
            const energyInputs = document.querySelectorAll('.energy_gwh');

            optInputs.forEach(el => el.value = 0);
            rtInputs.forEach(el => el.value = 0);
            rtrInputs.forEach(el => el.value = 0);
            energyInputs.forEach(el => el.value = 0);

            if (targetOptM > 0) {
                const target = targetOptM * 1e6;
                const rampY = optRampYear - startYear + 1;
                let prod = target / Math.pow(1.4, rampY - 1);
                for (let i = 0; i < rampY; i++) {
                    optInputs[i].value = Math.round(prod / 10000) * 10000;
                    prod *= 1.4;
                }
                let last = parseFloat(optInputs[rampY - 1].value) || 0;
                for (let i = rampY; i < years; i++) {
                    last *= (1 + optGrowthPct / 100);
                    optInputs[i].value = Math.round(last / 10000) * 10000;
                }
            }

            if (targetRtM > 0) {
                const target = targetRtM * 1e6;
                const rampY = rtRampYear - startYear + 1;
                let prod = target / Math.pow(1.4, rampY - 1);
                for (let i = 0; i < rampY; i++) {
                    rtInputs[i].value = Math.round(prod / 1000) * 1000;
                    prod *= 1.4;
                }
                let last = parseFloat(rtInputs[rampY - 1].value) || 0;
                for (let i = rampY; i < years; i++) {
                    last *= (1 + rtGrowthPct / 100);
                    rtInputs[i].value = Math.round(last / 1000) * 1000;
                }
            }

            if (targetRtrK > 0) {
                const target = targetRtrK * 1000;
                const rampY = rtrRampYear - startYear + 1;
                let prod = target / Math.pow(1.4, rampY - 1);
                for (let i = 0; i < rampY; i++) {
                    rtrInputs[i].value = Math.round(prod / 100) * 100;
                    prod *= 1.4;
                }
                let last = parseFloat(rtrInputs[rampY - 1].value) || 0;
                for (let i = rampY; i < years; i++) {
                    last *= (1 + rtrGrowthPct / 100);
                    rtrInputs[i].value = Math.round(last / 100) * 100;
                }
            }

            if (targetEnergyGWh > 0) {
                const target = targetEnergyGWh;
                const rampY = energyRampYear - startYear + 1;
                let prod = target / Math.pow(1.4, rampY - 1);
                for (let i = 0; i < rampY; i++) {
                    energyInputs[i].value = Math.round(prod * 10) / 10;
                    prod *= 1.4;
                }
                let last = parseFloat(energyInputs[rampY - 1].value) || 0;
                for (let i = rampY; i < years; i++) {
                    last *= (1 + energyGrowthPct / 100);
                    energyInputs[i].value = Math.round(last * 10) / 10;
                }
            }

            updateModel();
        });

        function updateModel() {
            const sharesOut = parseFloat(document.getElementById('shares_out').value) * 1e9 || 3.52e9;
            const multipleGrowth = parseFloat(document.getElementById('multiple_growth').value) || 40;
            const multipleMature = parseFloat(document.getElementById('multiple_mature').value) || 25;
            const yourShares = parseFloat(document.getElementById('your_shares').value) || 0;

            const optEnabled = document.getElementById('opt_enable').checked;
            const rtEnabled = document.getElementById('rt_enable').checked;
            const rtrEnabled = document.getElementById('rtr_enable').checked;
            const energyEnabled = document.getElementById('energy_enable').checked;

            let optHourly = 0, optHours = 0, optDays = 360, optSalesPrice = 0, optSalesMargin = 0;
            if (optEnabled) {
                optHourly = parseFloat(document.getElementById('opt_hourly').value) || 2;
                optHours = parseFloat(document.getElementById('opt_hours_day').value) || 21;
                optSalesPrice = parseFloat(document.getElementById('opt_sales_price').value) || 20000;
                optSalesMargin = parseFloat(document.getElementById('opt_sales_margin').value) / 100 || 0;
            }

            let rtKmDay = 0, rtEarnMile = 0, rtDays = 360, rtSalesPrice = 0, rtSalesMargin = 0;
            if (rtEnabled) {
                rtKmDay = parseFloat(document.getElementById('rt_mileage_km').value) || 350;
                rtEarnMile = parseFloat(document.getElementById('rt_earnings_mile').value) || 0.2;
                rtSalesPrice = parseFloat(document.getElementById('rt_sales_price').value) || 25000;
                rtSalesMargin = parseFloat(document.getElementById('rt_sales_margin').value) / 100 || 0;
            }

            let rtrKmDay = 0, rtrEarnMile = 0, rtrDays = 360, rtrSalesPrice = 0, rtrSalesMargin = 0;
            if (rtrEnabled) {
                rtrKmDay = parseFloat(document.getElementById('rtr_mileage_km').value) || 500;
                rtrEarnMile = parseFloat(document.getElementById('rtr_earnings_mile').value) || 2;
                rtrSalesPrice = parseFloat(document.getElementById('rtr_sales_price').value) || 250000;
                rtrSalesMargin = parseFloat(document.getElementById('rtr_sales_margin').value) / 100 || 0;
            }

            let energyHwRevPerGWh = 0, energyHwMargin = 0.32, energyRecurringPerGWhYr = 0, energyRecurringMargin = 0.80;
            if (energyEnabled) {
                energyHwRevPerGWh = parseFloat(document.getElementById('energy_hw_rev_per_gwh').value) || 280000000;
                energyRecurringPerGWhYr = parseFloat(document.getElementById('energy_recurring_per_gwh_yr').value) || 3500000;
            }

            const rate = parseFloat(document.getElementById('usd_eur_rate').value) || 0.86;
            const avgBuy = parseFloat(document.getElementById('avg_buy_price').value) || 280;
            const cgtPct = parseFloat(document.getElementById('cgt_rate').value) / 100 || 0.10;
            const cgtExemption = parseFloat(document.getElementById('cgt_exemption').value) || 10000;
            const annualPct = parseFloat(document.getElementById('annual_tax_rate').value) / 100 || 0.003;

            const optRampYear = parseInt(document.getElementById('opt_ramp_year').value) || 2040;
            const rtRampYear = parseInt(document.getElementById('rt_ramp_year').value) || 2040;
            const rtrRampYear = parseInt(document.getElementById('rtr_ramp_year').value) || 2040;
            const energyRampYear = parseInt(document.getElementById('rtr_ramp_year').value) || 2040;

            const lastRampYear = Math.max(optRampYear, rtRampYear, rtrRampYear, energyRampYear);
            const transitionStartYear = lastRampYear + 1;
            const transitionEndYear = transitionStartYear + PE_TRANSITION_YEARS - 1;

            const optRevPerUnit = optHourly * optHours * optDays;
            const rtRevPerUnit = (rtKmDay * 0.621371) * rtDays * rtEarnMile;
            const rtrRevPerUnit = (rtrKmDay * 0.621371) * rtrDays * rtrEarnMile;

            const optSalesProfit = optSalesPrice * optSalesMargin;
            const rtSalesProfit = rtSalesPrice * rtSalesMargin;
            const rtrSalesProfit = rtrSalesPrice * rtrSalesMargin;

            const optRevStr = optRevPerUnit.toLocaleString(undefined, {maximumFractionDigits: 0});
            const rtRevStr = rtRevPerUnit.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

            document.getElementById('optRevTitle').textContent = `Optimus Revenue ($B) â€“ \[ {optRevStr}/unit/yr`;
            document.getElementById('rtRevTitle').textContent = `Robotaxi Revenue ($B) â€“ \]{rtRevStr}/unit/yr`;

            const optProd = document.querySelectorAll('.opt_prod');
            const optFleetCells = document.querySelectorAll('.opt_fleet');
            const rtProd = document.querySelectorAll('.rt_prod');
            const rtFleetCells = document.querySelectorAll('.rt_fleet');
            const rtrProd = document.querySelectorAll('.rtr_prod');
            const rtrFleetCells = document.querySelectorAll('.rtr_fleet');
            const energyGwhInputs = document.querySelectorAll('.energy_gwh');
            const energyCumCells = document.querySelectorAll('.energy_cum');

            const optContribCells = document.querySelectorAll('.yearly-opt-contrib');
            const rtContribCells = document.querySelectorAll('.yearly-rt-contrib');
            const rtrContribCells = document.querySelectorAll('.yearly-rtr-contrib');
            const energyContribCells = document.querySelectorAll('.yearly-energy-contrib');
            const priceCells = document.querySelectorAll('.yearly-price');
            const marketCapCells = document.querySelectorAll('.yearly-marketcap');
            const portfolioCells = document.querySelectorAll('.yearly-portfolio');
            const portfolioEurCells = document.querySelectorAll('.yearly-portfolio-eur');
            const annualTaxCells = document.querySelectorAll('.yearly-annual-tax');

            let optCum = 0, rtCum = 0, rtrCum = 0, energyCumGWh = 0;
            const optCumArr = [], rtCumArr = [], rtrCumArr = [], energyCumArr = [], priceArr = [], optRevArr = [], rtRevArr = [];

            for (let i = 0; i < years; i++) {
                const year = startYear + i;
                const op = optEnabled ? (parseFloat(optProd[i].value) || 0) : 0;
                const rp = rtEnabled ? (parseFloat(rtProd[i].value) || 0) : 0;
                const rtrp = rtrEnabled ? (parseFloat(rtrProd[i].value) || 0) : 0;
                const energyDeployGWh = energyEnabled ? (parseFloat(energyGwhInputs[i].value) || 0) : 0;

                optCum += op; rtCum += rp; rtrCum += rtrp; energyCumGWh += energyDeployGWh;

                optCumArr.push(optCum); rtCumArr.push(rtCum); rtrCumArr.push(rtrCum); energyCumArr.push(energyCumGWh);

                optFleetCells[i].textContent = optCum.toLocaleString();
                rtFleetCells[i].textContent = rtCum.toLocaleString();
                rtrFleetCells[i].textContent = rtrCum.toLocaleString();
                energyCumCells[i].textContent = energyCumGWh.toFixed(1);

                const optRecB = optEnabled ? (optCum * optRevPerUnit) / 1e9 : 0;
                const rtRecB = rtEnabled ? (rtCum * rtRevPerUnit) / 1e9 : 0;
                const rtrRecB = rtrEnabled ? (rtrCum * rtrRevPerUnit) / 1e9 : 0;
                const energyRecB = energyEnabled ? (energyCumGWh * energyRecurringPerGWhYr * energyRecurringMargin) / 1e9 : 0;

                const optSalesB = optEnabled ? (op * optSalesProfit) / 1e9 : 0;
                const rtSalesB = rtEnabled ? (rp * rtSalesProfit) / 1e9 : 0;
                const rtrSalesB = rtrEnabled ? (rtrp * rtrSalesProfit) / 1e9 : 0;
                const energyHwProfitB = energyEnabled ? (energyDeployGWh * energyHwRevPerGWh * energyHwMargin) / 1e9 : 0;

                const totalSalesB = optSalesB + rtSalesB + rtrSalesB + energyHwProfitB;
                const totalRevB = optRecB + rtRecB + rtrRecB + energyRecB + totalSalesB;

                let effectiveMultiple = multipleGrowth;
                if (year > lastRampYear) {
                    if (year <= transitionEndYear) {
                        const yearsInto = year - transitionStartYear + 1;
                        const blend = yearsInto / PE_TRANSITION_YEARS;
                        effectiveMultiple = multipleGrowth * (1 - blend) + multipleMature * blend;
                    } else {
                        effectiveMultiple = multipleMature;
                    }
                }

                const optVal = (optRecB + optSalesB) * 1e9 * effectiveMultiple;
                const rtVal = (rtRecB + rtSalesB) * 1e9 * effectiveMultiple;
                const rtrVal = (rtrRecB + rtrSalesB) * 1e9 * effectiveMultiple;
                const energyVal = (energyRecB + energyHwProfitB) * 1e9 * effectiveMultiple;

                const optContrib = optEnabled ? optVal / sharesOut : 0;
                const rtContrib = rtEnabled ? rtVal / sharesOut : 0;
                const rtrContrib = rtrEnabled ? rtrVal / sharesOut : 0;
                const energyContrib = energyEnabled ? energyVal / sharesOut : 0;

                const totalVal = totalRevB * 1e9 * effectiveMultiple;
                const perShare = totalVal / sharesOut;

                optContribCells[i].textContent = '$' + Math.round(optContrib);
                rtContribCells[i].textContent = '$' + Math.round(rtContrib);
                rtrContribCells[i].textContent = '$' + Math.round(rtrContrib);
                energyContribCells[i].textContent = '$' + Math.round(energyContrib);

                priceCells[i].textContent = '$' + Math.round(perShare);
                marketCapCells[i].textContent = (totalVal / 1e12).toFixed(1);
                portfolioCells[i].textContent = '$' + (perShare * yourShares).toLocaleString(undefined, {maximumFractionDigits:0});

                const portfolioEur = (perShare * yourShares) * rate;
                portfolioEurCells[i].textContent = 'â‚¬' + Math.round(portfolioEur).toLocaleString();
                annualTaxCells[i].textContent = 'â‚¬' + Math.round(Math.max(0, (portfolioEur - 1000000) * annualPct)).toLocaleString();

                priceArr.push(perShare);
                optRevArr.push(optRecB + optSalesB);
                rtRevArr.push(rtRecB + rtSalesB);
            }

            const finalOptRecB = optEnabled ? (optCum * optRevPerUnit) / 1e9 : 0;
            const finalRtRecB = rtEnabled ? (rtCum * rtRevPerUnit) / 1e9 : 0;
            const finalRtrRecB = rtrEnabled ? (rtrCum * rtrRevPerUnit) / 1e9 : 0;
            const finalEnergyRecB = energyEnabled ? (energyCumGWh * energyRecurringPerGWhYr * energyRecurringMargin) / 1e9 : 0;

            const finalOptSalesB = optEnabled ? (parseFloat(optProd[years-1].value) * optSalesProfit) / 1e9 : 0;
            const finalRtSalesB = rtEnabled ? (parseFloat(rtProd[years-1].value) * rtSalesProfit) / 1e9 : 0;
            const finalRtrSalesB = rtrEnabled ? (parseFloat(rtrProd[years-1].value) * rtrSalesProfit) / 1e9 : 0;
            const finalEnergyHwB = energyEnabled ? (parseFloat(energyGwhInputs[years-1].value) * energyHwRevPerGWh * energyHwMargin) / 1e9 : 0;

            const optVal = (finalOptRecB + finalOptSalesB) * multipleMature;
            const rtVal = (finalRtRecB + finalRtSalesB) * multipleMature;
            const rtrVal = (finalRtrRecB + finalRtrSalesB) * multipleMature;
            const energyVal = (finalEnergyRecB + finalEnergyHwB) * multipleMature;
            const combVal = optVal + rtVal + rtrVal + energyVal;

            document.getElementById('optPerShare').textContent = '$' + Math.round(optVal * 1e9 / sharesOut).toLocaleString();
            document.getElementById('rtPerShare').textContent = '$' + Math.round(rtVal * 1e9 / sharesOut).toLocaleString();
            document.getElementById('rtrPerShare').textContent = '$' + Math.round(rtrVal * 1e9 / sharesOut).toLocaleString();
            document.getElementById('energyPerShare').textContent = '$' + Math.round(energyVal * 1e9 / sharesOut).toLocaleString();
            document.getElementById('combinedPerShare').textContent = '$' + Math.round(combVal * 1e9 / sharesOut).toLocaleString();

            document.getElementById('optSalesPerShare').textContent = '$' + Math.round(finalOptSalesB * multipleMature * 1e9 / sharesOut).toLocaleString();
            document.getElementById('rtSalesPerShare').textContent = '$' + Math.round(finalRtSalesB * multipleMature * 1e9 / sharesOut).toLocaleString();
            document.getElementById('rtrSalesPerShare').textContent = '$' + Math.round(finalRtrSalesB * multipleMature * 1e9 / sharesOut).toLocaleString();
            document.getElementById('energySalesPerShare').textContent = '$' + Math.round(finalEnergyHwB * multipleMature * 1e9 / sharesOut).toLocaleString();

            const portVal = (combVal * 1e9 / sharesOut) * yourShares;
            document.getElementById('portfolioValue').textContent = '$' + portVal.toLocaleString(undefined, {maximumFractionDigits:0});
            document.getElementById('yourSharesDisplay').textContent = yourShares;

            const futureEur = portVal * rate;
            const gainEur = futureEur - (yourShares * avgBuy);
            const taxable = Math.max(0, gainEur - cgtExemption);
            const netEur = futureEur - (taxable * cgtPct);
            document.getElementById('netEur').textContent = 'â‚¬' + Math.round(netEur).toLocaleString();

            fleetLineChart.data.datasets[0].data = optCumArr;
            fleetLineChart.data.datasets[1].data = rtCumArr;
            fleetLineChart.data.datasets[2].data = rtrCumArr;
            fleetLineChart.update();

            optProdChart.data.datasets[0].data = Array.from(optProd).map(el => parseFloat(el.value) || 0);
            optProdChart.data.datasets[1].data = optCumArr;
            optProdChart.update();

            rtProdChart.data.datasets[0].data = Array.from(rtProd).map(el => parseFloat(el.value) || 0);
            rtProdChart.data.datasets[1].data = rtCumArr;
            rtProdChart.update();

            rtrProdChart.data.datasets[0].data = Array.from(rtrProd).map(el => parseFloat(el.value) || 0);
            rtrProdChart.data.datasets[1].data = rtrCumArr;
            rtrProdChart.update();

            energyProdChart.data.datasets[0].data = Array.from(energyGwhInputs).map(el => parseFloat(el.value) || 0);
            energyProdChart.data.datasets[1].data = energyCumArr;
            energyProdChart.update();

            sharePriceChart.data.datasets[0].data = priceArr;
            sharePriceChart.update();

            optRevChart.data.datasets[0].data = optRevArr;
            optRevChart.update();

            rtRevChart.data.datasets[0].data = rtRevArr;
            rtRevChart.update();
        }

        function fetchTslaPrice() {
            fetch('https://query1.finance.yahoo.com/v7/finance/quote?symbols=TSLA')
                .then(r => r.json()).then(d => {
                    document.getElementById('current_tsla_price').value = d.quoteResponse.result[0].regularMarketPrice.toFixed(0);
                    updateModel();
                }).catch(() => alert('Could not fetch TSLA price'));
        }

        function fetchExchangeRate() {
            fetch('https://api.exchangerate.host/latest?base=USD&symbols=EUR')
                .then(r => r.json()).then(d => {
                    document.getElementById('usd_eur_rate').value = d.rates.EUR.toFixed(4);
                    updateModel();
                }).catch(() => alert('Could not fetch EUR rate'));
        }

        function exportToCsv() {
            let csv = "Year,Optimus Prod,Optimus Fleet,Robotaxi Prod,Robotaxi Fleet,Robotruck Prod,Robotruck Fleet,Energy GWh,Cum GWh,Opt $/sh,RT $/sh,RTR $/sh,Energy $/sh,Total $/sh,MktCap $T,Your $,Your â‚¬,Wealth Tax â‚¬\n";
            document.querySelectorAll('#yearTable tr').forEach(row => {
                const cells = Array.from(row.children).map(td => td.textContent || (td.querySelector('input') ? td.querySelector('input').value : ''));
                csv += cells.join(',') + '\n';
            });
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tesla_multi_stream_2040.csv';
            a.click();
        }

        window.onload = () => {
            initTailwind();
            buildTable();
            initCharts();
            updateModel();

            document.querySelectorAll('input').forEach(el => el.addEventListener('input', updateModel));
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
        };
    </script>
</body>
</html>
